{"ts":1371035248261,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"class AchievementScoresController < ApplicationController\n  before_filter :require_dashboard_access, :only   => [:destroy]\n  before_filter :require_api_access,       :except => [:destroy]\n  before_filter :set_achievement,          :except => [:destroy]\n\n  def create\n    err_message = nil\n    user_id = params[:achievement_score].delete(:user_id)\n    err_message = \"Please pass a user_id with your achievement_score.\"  if user_id.blank?\n\n    if !err_message\n      user = user_id && current_app.users.find_by_id(user_id.to_i)\n    end\n\n    err_message = \"User with that ID is not subscribed to this app.\"  if !user\n    if !err_message\n      @achievement_score = @achievement.achievement_scores.build(params[:achievement_score])\n      @achievement_score.user = user\n      if !@achievement_score.save\n        err_message = \"#{@achievement_score.errors.full_messages.join(\", \")}\"\n      end\n    end\n\n    if err_message\n      render status: :bad_request, json: {message: err_message}\n    else\n      render json: @achievement_score, location: @achievement_score\n    end\n  end\n\n\n  def destroy\n    @achievement_score = AchievementScore.find(params[:id].to_i)\n    if current_developer.authorized_to_delete_achievement_score?(@achievement_score)\n      @achievement_score.destroy\n      redirect_to achievement_scores_url, notice: \"Score was deleted.\"\n    else\n      redirect_to root_url, notice: \"You can't delete that score.\"\n    end\n  end\n\n  private\n  def set_achievement\n    l_id1 = params[:achievement_score] && params[:achievement_score].delete(:achievement_id)\n    l_id2 = params.delete(:achievement_id)\n    if(achievement_id = l_id1 || l_id2)\n      @achievement = current_app.achievements.find_by_id(achievement_id.to_i)\n    end\n\n    unless @achievement\n      render status: :forbidden, json: {message: \"Pass a achievement_id that belongs to the app associated with app_key\"}\n    end\n  end\nend\n"]],"start1":0,"start2":0,"length1":0,"length2":1888}]],"length":1888}
