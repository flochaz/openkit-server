{"ts":1371035270370,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"class DeveloperDataController < ApplicationController\n  before_filter :require_api_access,              :only => [:create, :show]\n  before_filter :require_dashboard_access,        :only => [:index]\n\n  # All data for this developer\n  def index\n    developer_data = DeveloperData.new(current_developer)\n    cloud_user_ids = developer_data.all_user_ids\n\n    # Get users for the first 10\n    x = cloud_user_ids[0..9]\n    @users = User.find_by_ids(x)\n    #@users.collect {|user| user.cloud_data = developer_data.\n\n    respond_to do |format|\n      format.html # index.html.erb\n      format.json { render json: @developer_data }\n    end\n  end\n\n  # GET /developer_data/1\n  # GET /developer_data/1.json\n  def show\n    key = params.delete(:id).to_s\n    err_out = \"\"\n    dev_data = get_interface(params[:user_id].to_i, err_out)\n    if err_out.blank?\n      x = dev_data.get(key)\n    end\n\n    if err_out.blank?\n      json = \"{#{key.to_json}:#{x}}\"\n      render json: json\n    else\n      render status: :bad_request, json: {message: err_out}\n    end\n\n    #respond_to do |format|\n    #  format.html # show.html.erb\n    #  format.json { render json: @developer_data }\n    #end\n  end\n\n  # POST /developer_data\n  # POST /developer_data.json\n  def create\n    err_out = \"\"\n    dev_data = get_interface(params[:user_id].to_i, err_out)\n    if err_out.blank?\n      dev_data.set(params[:field_key], params[:field_value])\n    end\n\n    if err_out.blank?\n      render json: {ok: \"yay\"}\n    else\n      render status: :bad_request, json: {message: err_out}\n    end\n  end\n\n\n  private\n  def get_interface(user_id, err_out)\n    dev_data = nil\n    if api_developer = current_app && current_app.developer\n      dev_data = DeveloperData.new(api_developer)\n      if user = api_developer.users.find_by_id(user_id)\n        dev_data.user = user\n      else\n        err_out << \"The submitted user does not belong to developer of app_key\" unless user\n      end\n    else\n      err_out << \"Could not find developer for app_key\" unless api_developer\n    end\n    dev_data\n  end\n\nend\n"]],"start1":0,"start2":0,"length1":0,"length2":2037}]],"length":2037}
